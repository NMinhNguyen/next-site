import Layout from '../../../../components/learn/Layout';
import Image from '../../../../components/image';
import Link from 'next/link';

export const meta = {
  title: 'Data Fetching',
  courseId: 'basics',
  lessonId: 'data-fetching',
  stepId: 'getstaticprops-details',
  subtitle: 'getStaticProps Details'
};

You can get in-depth information about `getStaticProps` on <Link href="/docs/[...slug]" as="/docs/basic-features/data-fetching"><a>our documentation</a></Link>. But here are some essential informationn you should know about `getStaticProps`.

### Fetch External API or Query Database

In our `lib/posts.js`, we’ve implemented `getSortedPostsData` which fetches data from the file system. But you can fetch the data from other sources, like an external API endpoint, and it’ll work just fine:

```js
import fetch from 'node-fetch';

export async function getSortedPostsData() {
  // Instead of the file system,
  // fetch post data from an external API endpoint
  const posts = await fetch('..');
  return res.json();
}
```

You can also query the database directly:

```js
import someDatabaseSDK from 'someDatabaseSDK'

const databaseClient = someDatabaseSDK.createClient(...)

export async function getSortedPostsData() {
  // Instead of the file system,
  // fetch post data from a database
  return databaseClient.query('SELECT posts...')
}
```

This is possible because `getStaticProps` runs **only on the server-side**. It will never be run on the client-side. It won’t even be included in the JS bundle for the browser. That means you can write code such as direct database queries without them being sent to browsers.

### Development v.s. Production

- In **development** (`npm run dev` or `yarn dev`), `getStaticProps` runs on _every request_.
- In **production**, `getStaticProps` runs at _build time_.

Because it’s meant to be run at build time, you won’t be able to use data that’s only available during request time, such as query parameters or HTTP headers.

### Only allowed in a page

`getStaticProps` can only be exported from a **page**. You can’t export it from non-page files.

One of the reasons for this restriction is that React needs to have all the required data before the page is rendered.

### When should I use `getStaticProps`?

You should use `getStaticProps` if:

- The data required to render the page is available at build time ahead of a user’s request.
- The data comes from headless CMS.
- The data can be publicly cached (not user-specific).
- The page must be pre-rendered (for SEO) and be very fast — `getStaticProps` generates HTML and JSON files, both of which can be cached by a CDN for performance.

### What if I need to fetch data at request time instead of build time?

Then you have two choices:

- Use `getServerSideProps` to do **server-side rendering**, which we talked about earlier. To learn more, take a look at <Link href="/docs/[...slug]" as="/docs/basic-features/data-fetching#getserversideprops-server-side-rendering"><a>our documentation</a></Link>.
- Do not pre-render the data — instead, pre-render the loading states. Then, fetch the data on the client side and display it when ready. To learn more, <Link href="/docs/[...slug]" as="/docs/basic-features/data-fetching#fetching-data-on-the-client-side"><a>take a look at our documentation</a></Link>.

### That’s It!

In the next lesson, we’ll create pages for each blog post using Dynamic Routing.

> Again, You can get in-depth information about `getStaticProps` on <Link href="/docs/[...slug]" as="/docs/basic-features/data-fetching"><a>our documentation</a></Link>.

export default ({ children }) => <Layout meta={meta}>{children}</Layout>;
